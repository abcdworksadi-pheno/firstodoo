<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Vue liste des instances -->
        <record id="view_lettre_instance_tree" model="ir.ui.view">
            <field name="name">lettre.motivation.instance.tree</field>
            <field name="model">lettre.motivation.instance</field>
            <field name="arch" type="xml">
                <list string="Lettres Générées">
                    <field name="name"/>
                    <field name="template_id"/>
                    <field name="date_generation"/>
                    <field name="state" widget="badge" decoration-success="state == 'generated'" decoration-info="state == 'sent'"/>
                </list>
            </field>
        </record>

        <!-- Vue formulaire des instances -->
        <record id="view_lettre_instance_form" model="ir.ui.view">
            <field name="name">lettre.motivation.instance.form</field>
            <field name="model">lettre.motivation.instance</field>
            <field name="arch" type="xml">
                <form string="Lettre de Motivation">
                    <header>
                        <button name="action_telecharger" string="Télécharger" type="object" 
                                invisible="not fichier_genere"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,generated,sent"/>
                    </header>
                    <sheet>
                        <group>
                            <group>
                                <field name="name"/>
                                <field name="template_id" readonly="state != 'draft'"/>
                                <field name="niveau" readonly="1"/>
                                <field name="format_sortie" readonly="state == 'generated'"/>
                            </group>
                            <group>
                                <field name="date_generation" readonly="1"/>
                            </group>
                        </group>
                        <notebook>
                            <page string="Variables" name="variables" invisible="state == 'generated'">
                                <field name="variables_valeurs_ids" nolabel="1" create="0" 
                                       context="{'default_instance_id': id, 'default_variable_id': False}">
                                    <list string="Variables" editable="bottom">
                                        <field name="variable_id" readonly="1" invisible="1" required="1"/>
                                        <field name="label" readonly="1"/>
                                        <field name="type" readonly="1"/>
                                        <field name="valeur"/>
                                        <field name="valeur_par_defaut" readonly="1"/>
                                        <field name="required" readonly="1" invisible="1"/>
                                    </list>
                                </field>
                            </page>
                            <page string="Contenu Généré" name="contenu">
                                <field name="contenu_final" widget="html" readonly="1" nolabel="1"/>
                            </page>
                            <page string="Valeurs des Variables (JSON)" name="valeurs_json">
                                <field name="valeurs_variables_dict" widget="text" readonly="1" nolabel="1"/>
                            </page>
                        </notebook>
                    </sheet>
                    <chatter/>
                </form>
            </field>
        </record>

        <!-- Vue recherche des instances -->
        <record id="view_lettre_instance_search" model="ir.ui.view">
            <field name="name">lettre.motivation.instance.search</field>
            <field name="model">lettre.motivation.instance</field>
            <field name="arch" type="xml">
                <search string="Rechercher une Lettre">
                    <field name="name"/>
                    <field name="template_id"/>
                    <filter string="Brouillon" name="draft" domain="[('state', '=', 'draft')]"/>
                    <filter string="Générées" name="generated" domain="[('state', '=', 'generated')]"/>
                    <filter string="Envoyées" name="sent" domain="[('state', '=', 'sent')]"/>
                </search>
            </field>
        </record>

        <!-- Action pour les instances -->
        <record id="action_lettre_instance" model="ir.actions.act_window">
            <field name="name">Lettres Générées</field>
            <field name="res_model">lettre.motivation.instance</field>
            <field name="view_mode">list,form</field>
            <field name="search_view_id" ref="view_lettre_instance_search"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Aucune lettre générée
                </p>
                <p>
                    Les lettres générées apparaîtront ici. Utilisez un modèle pour créer une nouvelle lettre.
                </p>
            </field>
        </record>
    </data>
</odoo>

